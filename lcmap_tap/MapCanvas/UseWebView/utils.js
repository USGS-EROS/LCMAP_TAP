window.onload = function(){
    var mapDiv = 'mapL';

    var map = L.map(mapDiv, {
        center: [39.8333, -98.5833],
        zoom: 4,
        dragging: true,
        scrollWheelZoom: true,
        proxyHost: 'http://srtm.webglearth.com/cgi-bin/corsproxy.fcgi?url='
    });

    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 18,
            id: 'mapbox.satellite',
            accessToken: 'pk.eyJ1IjoiZHplbGVuYWsiLCJhIjoiY2pqa2VpeWd3MTB0azNxbnowdmNyeG9qMiJ9.9S-ZHbulHg6aB9R5vM4cCg'
        }).addTo(map);

    // Add HV-tile features overlay to the map
    var hv_tiles = [
            {'type': 'Feature',
        'geometry': {'type': 'MultiPolygon',
            'coordinates': [[[[-121.4282844264539, 35.29559726260447, 0.0],
            [-119.8166353246277, 35.63894025488821, 0.0],
            [-120.2382285914156, 36.93561595273131, 0.0],
            [-121.8756591847893, 36.58666952745788, 0.0],
            [-121.4282844264539, 35.29559726260447, 0.0]]]]}},
        {'type': 'Feature',
        'geometry': {'type': 'MultiPolygon',
            'coordinates': [[[[-121.8756591847893, 36.58666952745788, 0.0],
            [-120.2382285914156, 36.93561595273131, 0.0],
            [-120.6746739306277, 38.22998742468571, 0.0],
            [-122.338645749086, 37.87507739574242, 0.0],
            [-121.8756591847893, 36.58666952745788, 0.0]]]]}},
        {'type': 'Feature',
        'geometry': {'type': 'MultiPolygon',
            'coordinates': [[[[-119.8166353246277, 35.63894025488821, 0.0],
            [-118.1908714599054, 35.96008134195213, 0.0],
            [-118.5859542182734, 37.26208671713795, 0.0],
            [-120.2382285914156, 36.93561595273131, 0.0],
            [-119.8166353246277, 35.63894025488821, 0.0]]]]}},
        {'type': 'Feature',
        'geometry': {'type': 'MultiPolygon',
            'coordinates': [[[[-120.2382285914156, 36.93561595273131, 0.0],
            [-118.5859542182734, 37.26208671713795, 0.0],
            [-118.9950795596038, 38.56213390200198, 0.0],
            [-120.6746739306277, 38.22998742468571, 0.0],
            [-120.2382285914156, 36.93561595273131, 0.0]]]]}},
        {'type': 'Feature',
        'geometry': {'type': 'MultiPolygon',
            'coordinates': [[[[-121.2794027881017, 45.05483833952156, 0.0],
            [-119.4304572787292, 45.39672725103019, 0.0],
            [-119.907454445631, 46.70669715153387, 0.0],
            [-121.7904655687912, 46.3567838678122, 0.0],
            [-121.2794027881017, 45.05483833952156, 0.0]]]]}},
        {'type': 'Feature',
        'geometry': {'type': 'MultiPolygon',
            'coordinates': [[[[-121.7904655687912, 46.3567838678122, 0.0],
            [-119.907454445631, 46.70669715153387, 0.0],
            [-120.4038393773553, 48.02029087137335, 0.0],
            [-122.3220771382848, 47.66174845919238, 0.0],
            [-121.7904655687912, 46.3567838678122, 0.0]]]]}},
        {'type': 'Feature',
        'geometry': {'type': 'MultiPolygon',
            'coordinates': [[[[-119.4304572787292, 45.39672725103019, 0.0],
            [-117.563228529389, 45.71330488465043, 0.0],
            [-118.0050699198637, 47.03083969930686, 0.0],
            [-119.907454445631, 46.70669715153387, 0.0],
            [-119.4304572787292, 45.39672725103019, 0.0]]]]}},
        {'type': 'Feature',
        'geometry': {'type': 'MultiPolygon',
            'coordinates': [[[[-119.907454445631, 46.70669715153387, 0.0],
            [-118.0050699198637, 47.03083969930686, 0.0],
            [-118.4650518779139, 48.35257813684066, 0.0],
            [-120.4038393773553, 48.02029087137335, 0.0],
            [-119.907454445631, 46.70669715153387, 0.0]]]]}},
        {'type': 'Feature',
        'geometry': {'type': 'MultiPolygon',
            'coordinates': [[[[-103.6167344716573, 43.15595164280422, 0.0],
            [-101.7660407520093, 43.25045316271344, 0.0],
            [-101.8808538437608, 44.59285804928355, 0.0],
            [-103.7681127615736, 44.4962355179408, 0.0],
            [-103.6167344716573, 43.15595164280422, 0.0]]]]}},
        {'type': 'Feature',
        'geometry': {'type': 'MultiPolygon',
            'coordinates': [[[[-103.7681127615736, 44.4962355179408, 0.0],
            [-101.8808538437608, 44.59285804928355, 0.0],
            [-102.0003259321787, 45.9391032643217, 0.0],
            [-103.9256159407411, 45.84019884804006, 0.0],
            [-103.7681127615736, 44.4962355179408, 0.0]]]]}},
        {'type': 'Feature',
        'geometry': {'type': 'MultiPolygon',
            'coordinates': [[[[-101.7660407520093, 43.25045316271344, 0.0],
            [-99.91095836057154, 43.31882269537059, 0.0],
            [-99.98893959852762, 44.66276873738538, 0.0],
            [-101.8808538437608, 44.59285804928355, 0.0],
            [-101.7660407520093, 43.25045316271344, 0.0]]]]}},
        {'type': 'Feature',
        'geometry': {'type': 'MultiPolygon',
            'coordinates': [[[[-101.8808538437608, 44.59285804928355, 0.0],
            [-99.98893959852762, 44.66276873738538, 0.0],
            [-100.0700919251, 46.01067243925812, 0.0],
            [-102.0003259321787, 45.9391032643217, 0.0],
            [-101.8808538437608, 44.59285804928355, 0.0]]]]}},
        {'type': 'Feature',
        'geometry': {'type': 'MultiPolygon',
            'coordinates': [[[[-93.00249679608045, 31.26836582294522, 0.0],
            [-91.42364037914952, 31.21465516326106, 0.0],
            [-91.34632137962114, 32.55964145685282, 0.0],
            [-92.95180717592135, 32.61412799170059, 0.0],
            [-93.00249679608045, 31.26836582294522, 0.0]]]]}},
        {'type': 'Feature',
        'geometry': {'type': 'MultiPolygon',
            'coordinates': [[[[-92.95180717592135, 32.61412799170059, 0.0],
            [-91.34632137962114, 32.55964145685282, 0.0],
            [-91.26634702160021, 33.90162525157142, 0.0],
            [-92.89937429936695, 33.95693957964367, 0.0],
            [-92.95180717592135, 32.61412799170059, 0.0]]]]}},
        {'type': 'Feature',
        'geometry': {'type': 'MultiPolygon',
            'coordinates': [[[[-91.42364037914952, 31.21465516326106, 0.0],
            [-89.84730794199487, 31.13857982692021, 0.0],
            [-89.7434894323892, 32.48247078760775, 0.0],
            [-91.34632137962114, 32.55964145685282, 0.0],
            [-91.42364037914952, 31.21465516326106, 0.0]]]]}},
        {'type': 'Feature',
        'geometry': {'type': 'MultiPolygon',
            'coordinates': [[[[-91.34632137962114, 32.55964145685282, 0.0],
            [-89.7434894323892, 32.48247078760775, 0.0],
            [-89.63611251873675, 33.82328604759104, 0.0],
            [-91.26634702160021, 33.90162525157142, 0.0],
            [-91.34632137962114, 32.55964145685282, 0.0]]]]}},
        {'type': 'Feature',
        'geometry': {'type': 'MultiPolygon',
            'coordinates': [[[[-89.16709937387972, 39.16840759982214, 0.0],
            [-87.42186600534691, 39.06000701569081, 0.0],
            [-87.26120261085924, 40.39305640207057, 0.0],
            [-89.03886118080074, 40.50354523175656, 0.0],
            [-89.16709937387972, 39.16840759982214, 0.0]]]]}},
        {'type': 'Feature',
        'geometry': {'type': 'MultiPolygon',
            'coordinates': [[[[-89.03886118080074, 40.50354523175656, 0.0],
            [-87.26120261085924, 40.39305640207057, 0.0],
            [-87.0944240461745, 41.7269872957799, 0.0],
            [-88.90572655103385, 41.83971150008596, 0.0],
            [-89.03886118080074, 40.50354523175656, 0.0]]]]}},
        {'type': 'Feature',
        'geometry': {'type': 'MultiPolygon',
            'coordinates': [[[[-87.42186600534691, 39.06000701569081, 0.0],
            [-85.68241454276455, 38.92717146947503, 0.0],
            [-85.48965498316664, 40.25767764906465, 0.0],
            [-87.26120261085924, 40.39305640207057, 0.0],
            [-87.42186600534691, 39.06000701569081, 0.0]]]]}},
        {'type': 'Feature',
        'geometry': {'type': 'MultiPolygon',
            'coordinates': [[[[-87.26120261085924, 40.39305640207057, 0.0],
            [-85.48965498316664, 40.25767764906465, 0.0],
            [-85.28958688754189, 41.58888695639023, 0.0],
            [-87.0944240461745, 41.7269872957799, 0.0],
            [-87.26120261085924, 40.39305640207057, 0.0]]]]}},
        {'type': 'Feature',
        'geometry': {'type': 'MultiPolygon',
            'coordinates': [[[[-78.80460018320562, 38.15449247098261, 0.0],
            [-77.11040864370645, 37.90192485280898, 0.0],
            [-76.76418675497824, 39.21337206186712, 0.0],
            [-78.48795156730563, 39.47054275029658, 0.0],
            [-78.80460018320562, 38.15449247098261, 0.0]]]]}},
        {'type': 'Feature',
        'geometry': {'type': 'MultiPolygon',
            'coordinates': [[[[-78.48795156730563, 39.47054275029658, 0.0],
            [-76.76418675497824, 39.21337206186712, 0.0],
            [-76.4052199244514, 40.52421328211765, 0.0],
            [-78.15956199999192, 40.78629879403802, 0.0],
            [-78.48795156730563, 39.47054275029658, 0.0]]]]}},
        {'type': 'Feature',
        'geometry': {'type': 'MultiPolygon',
            'coordinates': [[[[-77.11040864370645, 37.90192485280898, 0.0],
            [-75.42829653382272, 37.62603821074948, 0.0],
            [-75.05315891152108, 38.93252447345373, 0.0],
            [-76.76418675497824, 39.21337206186712, 0.0],
            [-77.11040864370645, 37.90192485280898, 0.0]]]]}},
        {'type': 'Feature',
        'geometry': {'type': 'MultiPolygon',
            'coordinates': [[[[-76.76418675497824, 39.21337206186712, 0.0],
            [-75.05315891152108, 38.93252447345373, 0.0],
            [-74.66432019459366, 40.2380718551557, 0.0],
            [-76.4052199244514, 40.52421328211765, 0.0],
            [-76.76418675497824, 39.21337206186712, 0.0]]]]}}];


    var tileOptions = {
        "color": "#0066ff",
        "weight": 1.5,
        "opacity": 1,
        "fillOpacity": 0
    };

    var markerOptions = {
        radius: 4,
        fillColor: "#00ff33",
        color: "#336600",
        weight: 1,
        opacity: 0.8,
        fillOpacity: 0.5
    }

    // Enable interactions with python using the
    function onEachFeatureHandler(feature, layer){
        layer.on('click', function(e){
            MapCanvas.onPointChanged(e.latlng.lat, e.latlng.lng);
            new L.CircleMarker(e.latlng, markerOptions).addTo(map);
        });
    }

    overlay = L.geoJson(hv_tiles, {
        onEachFeature: onEachFeatureHandler,
        style: tileOptions
    }).addTo(map);

}